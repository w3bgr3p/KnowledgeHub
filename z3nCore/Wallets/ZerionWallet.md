# ZerionWallet

Класс для автоматизации кошелька Zerion в браузерных скриптах. Позволяет устанавливать расширение, импортировать кошельки по приватному ключу или мнемонике, подписывать транзакции и проверять доступные для получения награды.

## Конструктор

### ZerionWallet(project, instance, log, key, fileName)

Создает новый экземпляр класса для работы с кошельком Zerion.

**Параметры:**
- **project** (IZennoPosterProjectModel) - текущий проект
- **instance** (Instance) - экземпляр браузера
- **log** (bool) - включить логирование (по умолчанию false)
- **key** (string) - ключ кошелька ("key", "seed" или прямое значение, по умолчанию "key")  
- **fileName** (string) - имя файла расширения (по умолчанию "Zerion1.21.3.crx")

**Пример:**
```csharp
var wallet = new ZerionWallet(project, instance, log: true);
```

## Методы

### Launch(fileName, log, source, refCode)

**Возвращает:** string - адрес активного кошелька

Устанавливает расширение Zerion, импортирует кошелек и подготавливает его к использованию. Автоматически определяет состояние кошелька и выполняет необходимые действия для полной настройки.

**Параметры:**
- **fileName** (string) - имя файла расширения (необязательно)
- **log** (bool) - включить логирование (по умолчанию false)
- **source** (string) - источник ключа ("key" или "seed", по умолчанию "key")
- **refCode** (string) - реферальный код (необязательно)

**Пример:**
```csharp
//запустить кошелек с основным ключом
string address = wallet.Launch();
project.SendInfoToLog($"Кошелек запущен: {address}");

//запустить с реферальным кодом
string address = wallet.Launch(refCode: "ABC123");
project.SendInfoToLog($"Кошелек запущен с рефералом: {address}");
```

### Sign(log, deadline)

**Возвращает:** bool - true если транзакция успешно подписана

Подписывает транзакцию или сообщение в кошельке Zerion. Автоматически находит кнопки "Confirm" или "Sign" и нажимает их.

**Параметры:**
- **log** (bool) - включить логирование (по умолчанию false)
- **deadline** (int) - максимальное время ожидания в секундах (по умолчанию 10)

**Пример:**
```csharp
//подписать транзакцию
bool success = wallet.Sign();
if (success)
{
    project.SendInfoToLog("Транзакция подписана");
}

//подписать с увеличенным временем ожидания
bool success = wallet.Sign(deadline: 30);
```

### Connect(log)

Подключает кошелек к веб-сайту. Автоматически обрабатывает процесс подключения, включая добавление сайта в список доверенных и подтверждение подключения.

**Параметры:**
- **log** (bool) - включить логирование (по умолчанию false)

**Пример:**
```csharp
//подключить кошелек к сайту
wallet.Connect();
```

### SwitchSource(addressToUse)

Переключает активный адрес кошелька на указанный источник.

**Параметры:**
- **addressToUse** (string) - источник адреса ("key" для основного ключа, "seed" для мнемоники, по умолчанию "key")

**Пример:**
```csharp
//переключиться на основной ключ
wallet.SwitchSource("key");

//переключиться на адрес из мнемоники
wallet.SwitchSource("seed");
```

### WaitTx(deadline, log)

**Возвращает:** bool - true если транзакция успешна, false если неудачна

Ожидает завершения транзакции в истории кошелька. Проверяет статус последней транзакции до её завершения.

**Параметры:**
- **deadline** (int) - максимальное время ожидания в секундах (по умолчанию 60)
- **log** (bool) - включить логирование (по умолчанию false)

**Пример:**
```csharp
//дождаться завершения транзакции
bool success = wallet.WaitTx();
if (success)
{
    project.SendInfoToLog("Транзакция выполнена успешно");
}
else
{
    project.SendErrorToLog("Транзакция не удалась");
}
```

### Claimable(address)

**Возвращает:** List<string> - список ID доступных для получения наград

Получает список квестов и наград, доступных для получения по указанному адресу через API Zerion.

**Параметры:**
- **address** (string) - адрес кошелька для проверки

**Пример:**
```csharp
//получить список доступных наград
var rewards = wallet.Claimable("0x742d35Cc6634C0532925a3b8D46d07c30e5b7A0c");
foreach (string rewardId in rewards)
{
    project.SendInfoToLog($"Доступна награда: {rewardId}");
}
```

### ActiveAddress()

**Возвращает:** string - адрес активного кошелька

Получает адрес текущего активного кошелька в расширении Zerion.

**Пример:**
```csharp
//получить адрес активного кошелька
string currentAddress = wallet.ActiveAddress();
project.SendInfoToLog($"Текущий адрес: {currentAddress}");
```

## Статические методы

### TxFromUrl(url)

**Возвращает:** string - JSON с данными транзакции

Извлекает данные транзакции из URL расширения Zerion.

**Параметры:**
- **url** (string) - URL с данными транзакции

**Пример:**
```csharp
//извлечь данные транзакции из URL
string txData = ZerionWallet.TxFromUrl(instance.ActiveTab.URL);
project.SendInfoToLog($"Данные транзакции: {txData}");
```